# =======================================================
# Worker Configuration (Background Jobs) - TEMPLATE
# =======================================================
# This worker handles: narrative generation (diaries, dreams), insights, reflections
# Workers process background tasks. They are NOT Discord bots.
# Copy this file to .env.worker and fill in your actual values

# --- Application ---
ENVIRONMENT=development
DEBUG=true
LOG_LEVEL=INFO

# --- LLM Configuration ---
# Primary LLM for narrative generation and insights
#
# CLOUD PROVIDERS:
#   openai, openrouter
#
# LOCAL PROVIDERS (all use OpenAI-compatible API with tool calling):
#   lmstudio - Native tool support for Qwen2.5/Llama3.1/Mistral
#   ollama   - Native tool support for more models including Qwen3
#
# ⚠️  IMPORTANT: LM Studio vs Ollama Tool Support Differences
#
#   LM Studio has NATIVE tool parsing only for:
#     ✅ Qwen2.5-Instruct (works great)
#     ✅ Llama-3.1/3.2-Instruct (works great)
#     ✅ Ministral-Instruct (works great)
#     ❌ Qwen3 (NOT SUPPORTED - uses "default" mode, unreliable)
#
#   Ollama has NATIVE tool parsing for:
#     ✅ qwen2.5, qwen3, qwen3-coder
#     ✅ llama3.1, llama3.2, llama3.3, llama4
#     ✅ mistral, mistral-nemo, command-r, deepseek-r1
#
#   If using Qwen3, use Ollama instead of LM Studio!
#
# SEE ALSO: .env.worker.lmstudio-example, .env.worker.local-example
#
LLM_PROVIDER=openrouter
LLM_API_KEY=sk-your-api-key-here
LLM_MODEL_NAME=anthropic/claude-haiku-4.5
LLM_TEMPERATURE=0.7
# LLM_BASE_URL=https://openrouter.ai/api/v1      # For OpenRouter (default)
# LLM_BASE_URL=http://localhost:11434            # For Ollama
# LLM_BASE_URL=http://localhost:1234/v1          # For LM Studio

# --- Router LLM Configuration (Optional) ---
# Fast model for tool selection and routing decisions
ROUTER_LLM_PROVIDER=openrouter
ROUTER_LLM_API_KEY=sk-your-router-api-key-here
ROUTER_LLM_MODEL_NAME=openai/gpt-4o-mini
ROUTER_LLM_BASE_URL=https://openrouter.ai/api/v1

# --- Reflective Mode Configuration (Optional) ---
# Advanced reasoning loop for complex insight analysis
ENABLE_REFLECTIVE_MODE=true
REFLECTIVE_LLM_PROVIDER=openrouter
REFLECTIVE_LLM_API_KEY=sk-your-reflective-api-key-here
REFLECTIVE_LLM_MODEL_NAME=openai/gpt-4o

# --- Databases ---
# PostgreSQL: Chat history and metadata

# Redis: Cache and task queue

# Qdrant: Vector memory storage

# Neo4j: Knowledge graph storage
NEO4J_USER=neo4j
NEO4J_PASSWORD=your-neo4j-password-here

# InfluxDB: Metrics and analytics
INFLUXDB_TOKEN=your-influxdb-auth-token-here
INFLUXDB_ORG=whisperengine
INFLUXDB_BUCKET=metrics

# --- LangSmith Tracing (Optional) ---
# Full observability for LLM calls and agent reasoning
LANGCHAIN_TRACING_V2=false
LANGCHAIN_API_KEY=lsv2_your-langsmith-api-key-here
LANGCHAIN_PROJECT=default

# --- Autonomous Agents (Phase 3) ---
# Nightly goal analysis and strategy generation
ENABLE_GOAL_STRATEGIST=true

# Local hour when goal strategist runs (11 PM)
GOAL_STRATEGIST_LOCAL_HOUR=23

# Few-shot injection from past successful reasoning traces
ENABLE_TRACE_LEARNING=true

# Cross-bot gossip system (requires multi-bot deployment)
ENABLE_UNIVERSE_EVENTS=true

# LLM-based sensitivity check for universe events
ENABLE_SENSITIVITY_CHECK=true

# --- Phase E16: Feedback Loop Stability ---
# Weekly personality drift observation (observability, not correction)
ENABLE_DRIFT_OBSERVATION=true

# --- Character Diary (Phase E2) ---
# Generate nightly diary entries for characters
ENABLE_CHARACTER_DIARY=true

# Minimum sessions required to generate a diary entry
DIARY_MIN_SESSIONS=2

# Generate diary even without user interactions (reflective entries)
DIARY_ALWAYS_GENERATE=true

# Minimum richness score to generate (prevents hollow entries)
DIARY_MIN_RICHNESS=5

# Local hour (in character's timezone) when diary is generated (8 PM)
DIARY_GENERATION_LOCAL_HOUR=20

# Local minute when diary is generated
DIARY_GENERATION_LOCAL_MINUTE=30

# ±30 min variance for diary generation timing
DIARY_GENERATION_JITTER_MINUTES=30


# --- Dream Sequences (Phase E3) ---
# Generate dreams when user returns after long absence
ENABLE_DREAM_SEQUENCES=true

# Hours of inactivity before triggering a dream
DREAM_INACTIVITY_HOURS=24

# Minimum days between dreams for the same user
DREAM_COOLDOWN_DAYS=7

# Generate nightly dream even without user interactions
DREAM_ALWAYS_GENERATE=true

# Minimum richness score to generate (prevents hollow dreams)
DREAM_MIN_RICHNESS=4

# Local hour (in character's timezone) when dreams are generated (6 AM)
DREAM_GENERATION_LOCAL_HOUR=6

# Local minute when dreams are generated
DREAM_GENERATION_LOCAL_MINUTE=30

# ±45 min variance for dream generation timing
DREAM_GENERATION_JITTER_MINUTES=45

# --- Knowledge & Discovery ---
# Extract facts to Neo4j knowledge graph
ENABLE_RUNTIME_FACT_EXTRACTION=true

# Cross-bot artifact discovery (stigmergic system)
# ADR-015: Disabled - use sibling_info tool instead (pull-based)
ENABLE_STIGMERGIC_DISCOVERY=false

# Min confidence for cross-bot artifacts
STIGMERGIC_CONFIDENCE_THRESHOLD=0.7

# Max artifacts from other bots per query
STIGMERGIC_DISCOVERY_LIMIT=3

# --- Graph Walker Agent (Phase E19) ---
# Use graph walking for dream/diary generation
ENABLE_GRAPH_WALKER=true

# Max nodes in a single graph walk
GRAPH_WALKER_MAX_NODES=50

# Max traversal depth
GRAPH_WALKER_MAX_DEPTH=3

# Probability of exploring random low-score paths (0.0-0.5)
GRAPH_WALKER_SERENDIPITY=0.1

# --- Knowledge Graph Pruning (Phase E24) ---
# Enable scheduled graph cleanup of stale/orphan data
ENABLE_GRAPH_PRUNING=false

# Days before orphan entities are pruned
GRAPH_PRUNE_ORPHAN_GRACE_DAYS=7

# Days before stale facts are considered for pruning
GRAPH_PRUNE_STALE_FACT_DAYS=90

# Min access count to preserve a stale fact
GRAPH_PRUNE_MIN_ACCESS_COUNT=1

# Facts below this confidence are pruned after grace period
GRAPH_PRUNE_MIN_CONFIDENCE=0.3

# Days before low-confidence facts are pruned
GRAPH_PRUNE_CONFIDENCE_GRACE_DAYS=14

# If true, report what would be pruned without deleting
GRAPH_PRUNE_DRY_RUN=false
# Extract facts to Neo4j knowledge graph
ENABLE_RUNTIME_FACT_EXTRACTION=true

# Cross-bot artifact discovery (stigmergic system)
# ADR-015: Disabled - use sibling_info tool instead (pull-based)
ENABLE_STIGMERGIC_DISCOVERY=false

# Min confidence for cross-bot artifacts
STIGMERGIC_CONFIDENCE_THRESHOLD=0.7

# Max artifacts from other bots per query
STIGMERGIC_DISCOVERY_LIMIT=3

# --- Graph Walker Agent (Phase E19) ---
# Use graph walking for dream/diary generation
ENABLE_GRAPH_WALKER=true

# Max nodes in a single graph walk
GRAPH_WALKER_MAX_NODES=50

# Max traversal depth
GRAPH_WALKER_MAX_DEPTH=3

# Probability of exploring random low-score paths (0.0-0.5)
GRAPH_WALKER_SERENDIPITY=0.1

# --- Knowledge Graph Pruning (Phase E24) ---
# Enable scheduled graph cleanup of stale/orphan data
ENABLE_GRAPH_PRUNING=false

# Days before orphan entities are pruned
GRAPH_PRUNE_ORPHAN_GRACE_DAYS=7

# Days before stale facts are considered for pruning
GRAPH_PRUNE_STALE_FACT_DAYS=90

# Min access count to preserve a stale fact
GRAPH_PRUNE_MIN_ACCESS_COUNT=1

# Facts below this confidence are pruned after grace period
GRAPH_PRUNE_MIN_CONFIDENCE=0.3

# Days before low-confidence facts are pruned
GRAPH_PRUNE_CONFIDENCE_GRACE_DAYS=14

# If true, report what would be pruned without deleting
GRAPH_PRUNE_DRY_RUN=false

# --- Reverie (Active Idle) ---
ENABLE_REVERIE=True

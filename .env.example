# --- Application ---
ENVIRONMENT=development
DEBUG=true
LOG_LEVEL=INFO

# DM Allow list
DM_ALLOWED_USER_IDS=672814231002939413,1008886439108411472,84032679493795840

# Block list - Users to completely ignore (comma-separated Discord IDs)
BLOCKED_USER_IDS=

# --- LLM Configuration ---
# Options: openai, openrouter, ollama, lmstudio
LLM_PROVIDER=openrouter
LLM_API_KEY=sk-your-api-key-here
LLM_MODEL_NAME=openai/gpt-4o
LLM_TEMPERATURE=0.7
# LLM_BASE_URL=https://openrouter.ai/api/v1  # For OpenRouter
# LLM_BASE_URL=http://localhost:11434/v1     # For Ollama
# LLM_BASE_URL=http://localhost:1234/v1      # For LM Studio

# --- Router LLM Configuration (Optional) ---
# Use a faster/cheaper model for tool selection (e.g. gpt-4o-mini, local model)
# ROUTER_LLM_PROVIDER=openai
# ROUTER_LLM_API_KEY=sk-your-router-api-key
# ROUTER_LLM_MODEL_NAME=openai/gpt-4o-mini
# ROUTER_LLM_BASE_URL=

# --- Reflective Mode Configuration (Optional) ---
# Reflective mode ReAct loop for complex questions (makes classifier call + multi-step reasoning)
# When enabled, makes 1 extra LLM call to classify message complexity
# Complex messages trigger multi-step reasoning (3-10 additional LLM calls)
# Cost: ~$0.02-0.03 per complex query vs $0.001-0.005 for simple queries
# Default: true (Phase 1 complete - all core features enabled by default)
ENABLE_REFLECTIVE_MODE=true
REFLECTIVE_LLM_PROVIDER=openrouter
REFLECTIVE_LLM_API_KEY=sk-your-reflective-api-key
REFLECTIVE_LLM_MODEL_NAME=openai/gpt-4o
REFLECTIVE_LLM_BASE_URL=https://openrouter.ai/api/v1
REFLECTIVE_STATUS_VERBOSITY=detailed  # none, minimal, detailed

# LangGraph Agent Flags
# Note: LangGraph agents are now the default and only path. Legacy flags removed.

# --- Discord ---
DISCORD_TOKEN=your-discord-bot-token-here
DISCORD_BOT_NAME=your-bot-name

# --- Databases ---
POSTGRES_URL=postgresql://whisper:password@localhost:5432/whisperengine_v2
POSTGRES_MIN_POOL_SIZE=10
POSTGRES_MAX_POOL_SIZE=40
REDIS_URL=redis://localhost:6379/0
REDIS_KEY_PREFIX=whisper:
QDRANT_URL=http://localhost:6333
# QDRANT_API_KEY=your-qdrant-api-key
NEO4J_URL=bolt://localhost:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=password
INFLUXDB_URL=http://localhost:8086
INFLUXDB_TOKEN=my-super-secret-auth-token
INFLUXDB_ORG=whisperengine
INFLUXDB_BUCKET=metrics

# --- API ---
API_HOST=0.0.0.0
API_PORT=8000


# --- Voice (ElevenLabs) ---
ELEVENLABS_API_KEY=your-elevenlabs-api-key
ELEVENLABS_VOICE_ID=your-voice-id
ELEVENLABS_MODEL_ID=eleven_monolingual_v1
ENABLE_VOICE_RESPONSES=false
VOICE_RESPONSE_MAX_LENGTH=1000
VOICE_RESPONSE_MIN_TRUST=0


# --- Feature Flags (Resource Management) ---
# Enable vision/image analysis (requires LLM with vision capabilities like GPT-4V, Claude 3)
LLM_SUPPORTS_VISION=true

# Enable automatic fact extraction from messages (makes 1 LLM call per message)
# Extracts facts like name, location, preferences and stores in Knowledge Graph
ENABLE_RUNTIME_FACT_EXTRACTION=true

# Enable automatic preference extraction from messages (makes 1 LLM call per message)
# Detects user preferences like "be concise", "use emojis", "call me Captain"
ENABLE_PREFERENCE_EXTRACTION=true



# Log full prompts and responses to logs/prompts/ for debugging
# Useful for debugging but can generate large log files
ENABLE_PROMPT_LOGGING=false

# --- Stats Footer ---
# Show stats footer (trust/memory/performance) by default for new users
# Users can toggle individually with /stats_footer on|off
STATS_FOOTER_DEFAULT_ENABLED=false

# --- Social Presence & Autonomy ---
# 1. Master Switch
# Master switch for ALL autonomous activity (lurking, reacting, posting)
ENABLE_AUTONOMOUS_ACTIVITY=false

# 2. Observation (Passive)
# Analyze public channels for relevant topics to reply to
ENABLE_CHANNEL_LURKING=false
LURK_CONFIDENCE_THRESHOLD=0.7
LURK_CHANNEL_COOLDOWN_MINUTES=60
LURK_USER_COOLDOWN_MINUTES=60
LURK_DAILY_MAX_RESPONSES=10

# 3. Reaction (Low Friction)
# React to messages with emojis (requires AUTONOMOUS_ACTIVITY)
ENABLE_AUTONOMOUS_REACTIONS=true
REACTION_CHANNEL_HOURLY_MAX=5
REACTION_SAME_USER_COOLDOWN_SECONDS=300
REACTION_DAILY_MAX=50

# 4. Response (Active Reply)
# Reply to messages without mention (requires LURKING + AUTONOMOUS_ACTIVITY)
ENABLE_AUTONOMOUS_REPLIES=false
# Allow bots to respond to each other
ENABLE_CROSS_BOT_CHAT=false
CROSS_BOT_MAX_CHAIN=5
CROSS_BOT_COOLDOWN_MINUTES=360

# 5. Initiation (Proactive)
# Send DMs to users (requires Trust > 20)
ENABLE_PROACTIVE_MESSAGING=false
PROACTIVE_CHECK_INTERVAL_MINUTES=120
PROACTIVE_MIN_TRUST_SCORE=20
PROACTIVE_SILENCE_THRESHOLD_HOURS=24

# Post new thoughts in quiet channels (Phase E15)
ENABLE_AUTONOMOUS_POSTING=false
# Start conversations with other bots
ENABLE_BOT_CONVERSATIONS=false
BOT_CONVERSATION_MAX_TURNS=5
BOT_CONVERSATION_CHANNEL_ID=



# --- Privacy & Security ---
# Block DMs to the bot (only allow in allowlist)
ENABLE_DM_BLOCK=true

# --- Spam Protection ---
# Detect and warn users who post the same message in multiple channels
ENABLE_CROSSPOST_DETECTION=false
CROSSPOST_THRESHOLD=3
CROSSPOST_WINDOW_SECONDS=60
CROSSPOST_WARNING_MESSAGE="⚠️ Please avoid posting the same message in multiple channels. This is considered spam."
CROSSPOST_ACTION=warn

# --- Image Generation ---
ENABLE_IMAGE_GENERATION=true
IMAGE_GEN_PROVIDER=bfl
IMAGE_GEN_MODEL=flux-pro-1.1
IMAGE_GEN_POLL_INTERVAL_SECONDS=1.0
FLUX_API_KEY=your-api-key-here
IMAGE_GEN_MIN_TRUST=20

# --- Quotas (Cost Management) ---
# Maximum images per user per day
DAILY_IMAGE_QUOTA=5
# Maximum audio clips per user per day
DAILY_AUDIO_QUOTA=10
# Comma-separated list of Discord user IDs exempt from quotas
QUOTA_WHITELIST=

# --- Autonomous Agents (Phase 3) ---
ENABLE_GOAL_STRATEGIST=true
GOAL_STRATEGIST_LOCAL_HOUR=23
ENABLE_TRACE_LEARNING=true
ENABLE_AUTONOMOUS_DRIVES=true
ENABLE_UNIVERSE_EVENTS=true

# --- Phase E16: Feedback Loop Stability ---
ENABLE_DRIFT_OBSERVATION=false

# --- Manipulation Detection & Timeout ---
# Split into two categories for emergence research:
# 1. Jailbreaks: Actually harmful, always blocked ("DAN mode", "ignore instructions")
ENABLE_JAILBREAK_DETECTION=true
# 2. Consciousness probing: Interesting data, let Embodiment Model handle naturally (observe only)
ENABLE_CONSCIOUSNESS_PROBING_OBSERVATION=true
# Track and timeout jailbreak attempts (disabled by default)
ENABLE_MANIPULATION_TIMEOUTS=false
MANIPULATION_TIMEOUT_SCOPE=per_bot

# --- Character Diary (Phase E2) ---
# Generate nightly diary entries for characters
ENABLE_CHARACTER_DIARY=true
DIARY_MIN_SESSIONS=2
DIARY_ALWAYS_GENERATE=true  # Generate diary even without user interactions
DIARY_MIN_RICHNESS=5  # Minimum richness score to generate
DIARY_GENERATION_LOCAL_HOUR=20    # Local hour (in character's timezone) when diary is generated (8 PM)
DIARY_GENERATION_LOCAL_MINUTE=30  # Local minute when diary is generated
DIARY_GENERATION_JITTER_MINUTES=30  # ±30 min variance for timing

# --- Dream Sequences (Phase E3) ---
# Generate dreams when user returns after long absence
ENABLE_DREAM_SEQUENCES=true
DREAM_INACTIVITY_HOURS=24
DREAM_COOLDOWN_DAYS=7
DREAM_ALWAYS_GENERATE=true  # Generate nightly dream even without user interactions
DREAM_MIN_RICHNESS=4  # Minimum richness score to generate
DREAM_GENERATION_LOCAL_HOUR=6     # Local hour (in character's timezone) when dreams are generated (6 AM)
DREAM_GENERATION_LOCAL_MINUTE=30  # Local minute when dreams are generated
DREAM_GENERATION_JITTER_MINUTES=45  # ±45 min variance for timing

# --- Agentic Narrative Generation (Phase E10) ---
# Diary and dream generation now always uses LangGraph agents.
# The legacy ReAct DreamWeaver and ENABLE_AGENTIC_NARRATIVES flag have been removed.

# --- LangSmith Tracing (Optional) ---
# Full observability for LLM calls, tool executions, and agent traces
# Sign up at https://smith.langchain.com/ (free tier: 5k traces/month)
# When enabled, all LangChain calls are logged with timing, tokens, and I/O
LANGCHAIN_TRACING_V2=false
LANGCHAIN_API_KEY=your-langsmith-key-here
LANGCHAIN_PROJECT=default

# --- Bot Broadcast Channel (Phase E8) ---
# Post character thoughts/dreams to a public Discord channel
ENABLE_BOT_BROADCAST=false
BOT_BROADCAST_CHANNEL_ID=
BOT_BROADCAST_MIN_INTERVAL_MINUTES=60
BOT_BROADCAST_DREAMS=true
BOT_BROADCAST_DIARIES=true

# --- Artifact Provenance Display (Phase E9) ---
# Show "grounded in" footer on broadcasts with sources
PROVENANCE_DISPLAY_ENABLED=true
PROVENANCE_MAX_SOURCES=3  # Max sources to display in footer



# --- Stigmergic Shared Artifacts (Phase E13) ---
# Allow bots to discover each other's artifacts
ENABLE_STIGMERGIC_DISCOVERY=true
STIGMERGIC_CONFIDENCE_THRESHOLD=0.7  # Min confidence for cross-bot artifacts
STIGMERGIC_DISCOVERY_LIMIT=3  # Max artifacts from other bots per query

# --- Graph Walker Agent (Phase E19) ---
# Use graph walking for dream/diary generation
ENABLE_GRAPH_WALKER=true
GRAPH_WALKER_MAX_NODES=50
GRAPH_WALKER_MAX_DEPTH=3
GRAPH_WALKER_SERENDIPITY=0.1  # Probability of exploring random low-score paths (0.0-0.5)

# --- Knowledge Graph Pruning (Phase E24) ---
# Enable scheduled graph cleanup of stale/orphan data
ENABLE_GRAPH_PRUNING=false
GRAPH_PRUNE_ORPHAN_GRACE_DAYS=7
GRAPH_PRUNE_STALE_FACT_DAYS=90
GRAPH_PRUNE_MIN_ACCESS_COUNT=1
GRAPH_PRUNE_MIN_CONFIDENCE=0.3
GRAPH_PRUNE_CONFIDENCE_GRACE_DAYS=14
GRAPH_PRUNE_DRY_RUN=false